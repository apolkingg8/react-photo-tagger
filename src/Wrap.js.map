{"version":3,"sources":["Wrap.jsx"],"names":[],"mappings":"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","file":"Wrap.js","sourcesContent":["import React from 'react'\nimport _ from 'underscore'\n\nimport Img from './Img'\nimport ChoosingBox from './ChoosingBox'\nimport CommandBox from './CommandBox'\n\n\n\n\nvar Wrap = React.createClass({\n\n    getInitialState: function() {\n\n        return {\n            offsetTop: 0,\n            offsetLeft: 0,\n\n            mouseDownX: 0,\n            mouseDownY: 0,\n            mouseUpX: 0,\n            mouseUpY: 0,\n            mouseX: 0,\n            mouseY: 0,\n\n            choosingBoxShow: false,\n\n            commandBoxShow: false,\n\n            choosing: false,\n            mouseDownInChoosingBox: false\n        };\n    },\n\n    getDefaultProps: function() {\n        return {\n            imgSrc: '',\n            width: '100%',\n            height: '100%',\n            choosingBoxStyle: {},\n            commandBoxStyle: {}\n        }\n    },\n\n    _getRelativedX: function(e) {\n        return e.clientX - this.state.offsetLeft;\n    },\n\n    _getRelativedY: function(e) {\n        return e.clientY - this.state.offsetTop;\n    },\n\n    _isInChoosingBox: function(e) {\n        let x = this._getRelativedX(e);\n        let y = this._getRelativedY(e);\n\n        let result = (\n            (((this.state.mouseDownX) < x) && (x < this.state.mouseUpX))\n            &&\n            (((this.state.mouseDownY) < y) && (y < this.state.mouseUpY))\n        );\n\n        this.setState({\n            mouseDownInChoosingBox: result\n        });\n\n        return result\n    },\n\n    _isInCommandBox: function(e) {\n        let x = this._getRelativedX(e);\n        let y = this._getRelativedY(e);\n        let commandBoxStyle = this._getCommandBoxStyle();\n\n        return (\n            (commandBoxStyle.left > x) && ((commandBoxStyle.left + commandBoxStyle.width) < x)\n                &&\n            (commandBoxStyle.top > y) && ((commandBoxStyle.top + commandBoxStyle.height) < y)\n        )\n    },\n\n    onMouseMoveHandler: function(e) {\n        var that = this;\n        //console.log('mouse move');\n\n        if(this.state.choosing) {\n            console.log(that.state.mouseX, that.state.mouseY);\n\n            that.setState({\n                mouseX: that._getRelativedX(e),\n                mouseY: that._getRelativedY(e),\n            });\n        }\n    },\n\n    onMouseDownHandler: function(e) {\n        console.log('mouse down', e);\n\n        if(!this._isInChoosingBox(e) && !this._isInCommandBox(e)) {\n            e.preventDefault();\n            this.setState({\n                choosing: true,\n                choosingBoxShow: true,\n                mouseX: this._getRelativedX(e),\n                mouseY: this._getRelativedY(e),\n                mouseDownX: this._getRelativedX(e),\n                mouseDownY: this._getRelativedY(e),\n                commandBoxShow: false\n            });\n        }\n    },\n\n    onMouseUpHandler: function(e) {\n        console.log('mouse up', e);\n\n        if(!this.state.mouseDownInChoosingBox) {\n            this.setState({\n                choosing: false,\n                mouseUpX: this._getRelativedX(e),\n                mouseUpY: this._getRelativedY(e),\n                commandBoxShow: true\n            });\n        }\n    },\n\n    onMouseLeaveHandler: function(e) {\n        console.log('mouse leave', e);\n\n        this.setState({\n            choosing : false,\n            mouseUpX : this._getRelativedX(e),\n            mouseUpY : this._getRelativedY(e)\n        });\n    },\n\n    getStyle: function() {\n\n        return {\n            position: 'relative',\n            width: this.props['width'],\n            height: this.props['height'],\n            overflow: 'visible'\n        };\n    },\n\n    componentDidMount: function() {\n\n        this.setState({\n            offsetTop: this.getDOMNode().offsetTop,\n            offsetLeft: this.getDOMNode().offsetLeft\n        });\n    },\n\n    shouldComponentUpdate: function(nextProps, nextState) {\n\n        //return nextState.choosing\n        return true\n    },\n\n    _getChoosingBoxStyle: function() {\n        let state = this.state;\n        let startX = state.mouseDownX,\n            startY = state.mouseDownY,\n            endX = state.choosing ? state.mouseX : state.mouseUpX,\n            endY= state.choosing ? state.mouseY : state.mouseUpY;\n\n        let style = this.props['choosingBoxStyle'];\n\n        _.extend(style, {\n            top: startY < endY ? startY : endY,\n            left: startX < endX ? startX : endX,\n            width: Math.abs(startX - endX),\n            height: Math.abs(startY - endY)\n        });\n\n        return style\n    },\n\n    _getCommandBoxStyle: function() {\n        let choosingBoxStyle = this._getChoosingBoxStyle();\n\n        let style = this.props['commandBoxStyle'];\n\n        return _.extend({width: 80, height: 50}, style, {\n            top: choosingBoxStyle.top + choosingBoxStyle.height + 15,\n            left: choosingBoxStyle.left - 5\n        });\n    },\n\n    render: function() {\n        //console.log('render', this.state);\n\n        let state = this.state;\n\n\n\n        return (\n            <div className=\"react-photo-tagger-wrap\"\n                 onMouseDown={this.onMouseDownHandler}\n                 onMouseUp={this.onMouseUpHandler}\n                 onMouseMove={this.onMouseMoveHandler}\n                 style={this.getStyle()}>\n\n                <ChoosingBox\n                    style={this._getChoosingBoxStyle()}\n                    show={state.choosingBoxShow}>\n                </ChoosingBox>\n\n                <CommandBox\n                    style={this._getCommandBoxStyle()}\n                    show={state.commandBoxShow}>\n                </CommandBox>\n\n                <Img src={this.props['imgSrc']}/>\n            </div>\n        )\n    }\n});\n\nexport default Wrap;"]}